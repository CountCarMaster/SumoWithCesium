{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Use correct character set. -->
    <meta charset="utf-8"/>
    <!-- Tell IE to use the latest, best version. -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <title>Hello World!</title>
    <script type="text/javascript" src="http://libs.baidu.com/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript" src="{% static 'ajax.js' %}"></script>
    <script src="{% static 'Build/Cesium/Cesium.js' %}"></script>
    <style>
        @import url(../static/Build/Cesium/Widgets/widgets.css);

        html,
        body,
        #cesiumContainer {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
<div id="test"></div>
<div id="cesiumContainer"></div>
<script>

    function sleep(time) {
        return new Promise((resolve) => setTimeout(resolve, time));
    }

    Cesium.Ion.defaultAccessToken = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI4MzM5OTUxNi05NDM1LTRiZjktYTYzZS1jNjdkOGYzODY4MTQiLCJpZCI6MTAyNDg0LCJpYXQiOjE2NTg3NjI5Nzd9.LeY0XxRAw1keEGLweLto2-3HQLLCB3Ulmat8px_u5R8";
    // STEP 4 CODE (replaces steps 2 and 3)
    // Keep your `Cesium.Ion.defaultAccessToken = 'your_token_here'` line from before here.
    const viewer = new Cesium.Viewer('cesiumContainer', {
        terrainProvider: Cesium.createWorldTerrain()
    });
    const osmBuildings = viewer.scene.primitives.add(Cesium.createOsmBuildings());

    viewer.clock.multiplier = 0.5;

    /* Initialize the viewer clock:
      Assume the radar samples are 30 seconds apart, and calculate the entire flight duration based on that assumption.
      Get the start and stop date times of the flight, where the start is the known flight departure time (converted from PST
        to UTC) and the stop is the start plus the calculated duration. (Note that Cesium uses Julian dates. See
        https://simple.wikipedia.org/wiki/Julian_day.)
      Initialize the viewer's clock by setting its start and stop to the flight start and stop times we just calculated.
      Also, set the viewer's current time to the start time and take the user to that time.
    */

    viewer.camera.setView(
        {
            destination: Cesium.Cartesian3.fromDegrees(355.9, 1.6, 6357068.77482456663),
            orientation: {
                heading: Cesium.Math.toRadians(0.0), // east, default value is 0.0 (north)
                pitch: Cesium.Math.toRadians(-90),    // default value (looking down)
                roll: 0.0                             // default value
            }
        });
    sleep(2000);
    var positions = [];
    var num = 50;
    for(var i = 0; i < num; i++) {
        positions.push([]);
    }
    const airplaneUri = Cesium.IonResource.fromAssetId(1232489);
    var czmlinfo = [{
        "id": "document",
        "name": "CZML Path",
        "version": "1.0",
    }, {
        "id": "path1",
        "name": "path with GPS flight data",
        "availability": "2012-08-04T10:00:00Z/2012-08-04T15:00:00Z",
        "billboard": {
            "image": "data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMy4wLjMsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0i5Zyw56m65a+85by5XzFfIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiDQoJIHk9IjBweCIgdmlld0JveD0iMCAwIDMyIDMyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAzMiAzMjsiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4NCgkuc3Qwe3N0cm9rZTojMDAwMEZGO3N0cm9rZS1taXRlcmxpbWl0OjEwO30NCgkuc3Qxe2ZpbGw6bm9uZTtzdHJva2U6IzAwMDBGRjtzdHJva2UtbWl0ZXJsaW1pdDoxMDt9DQo8L3N0eWxlPg0KPHBvbHlnb24gY2xhc3M9InN0MCIgcG9pbnRzPSIxNS41LDUuMDQgMTIuNSwxMC4yMyAxOC41LDEwLjIzICIvPg0KPGxpbmUgY2xhc3M9InN0MSIgeDE9IjE1LjUiIHkxPSIxMC41IiB4Mj0iMTUuNSIgeTI9IjI2LjUiLz4NCjxsaW5lIGNsYXNzPSJzdDEiIHgxPSIxMi41IiB5MT0iMjYuNSIgeDI9IjE4LjUiIHkyPSIyNi41Ii8+DQo8bGluZSBjbGFzcz0ic3QxIiB4MT0iMTUuNSIgeTE9IjIwLjUiIHgyPSIxMi41IiB5Mj0iMjMuNSIvPg0KPGxpbmUgY2xhc3M9InN0MSIgeDE9IjE4LjUiIHkxPSIyMy41IiB4Mj0iMTUuNSIgeTI9IjIwLjUiLz4NCjwvc3ZnPg0K",
            "scale": 0.2
         },
        {#"model": {#}
        {#    "uri": airplaneUri,#}
        {#    "minimumPixalSize": 12000,#}
        {#    "color": "white"#}
        {# },#}
        {#"point": {#}
        {#    "pixalSize": 12000#}
        {# },#}
        "position": {
            "cartographicDegrees": [118.87826541800007, 30.956799, 0.0,]
        }
    }];
    var numm = 0;
    var ax = 10000;
    var bx = 10000;
    var czmlBox = [];
    var dataSourceBox = [];
    var ii = [];
    var bb = [];
    for(var i = 0; i < num; i++) {
        ii.push(ax);
        bb.push(bx);
        czmlBox.push(czmlinfo);
        var DataSource = new Cesium.CzmlDataSource();
        viewer.dataSources.add(DataSource.load(czmlinfo));
        dataSourceBox.push(DataSource);
    }
    var realTimeClData = setInterval(function () {
        numm += 1;
        for (var i = 0; i < num; i++) {
            var k = 0;
            var kk = 0;
            {#console.log(numm);#}
            {#console.log(i);#}
            $.ajax({
                type: 'GET',
                url: "/ajax/get/",
                data: {'a': numm, 'b': i},
                async: false,
                success: function (ret) {
                    {#$('#result_get').html(ret);#}
                    k = Number(ret);
                }
            });
            console.log(k);
            $.ajax({
                type: 'GET',
                url: "/ajax/get2/",
                data: {'a': numm, 'b': i},
                async: false,
                success: function (ret) {
                    {#$('#result_get').html(ret);#}
                    kk = Number(ret);
                }
            });
            if(k === 0) {
                break;
            }
            ii[i] = k;
            bb[i] = kk;
            //图标
            var loca_1 = new Cesium.Cartesian3(ii[i], bb[i], 6356068.77482456663);
            var loca_2 = Cesium.Cartographic.fromCartesian(loca_1);
            czmlBox[i][1].position.cartographicDegrees = [loca_2.longitude, loca_2.latitude, 0];
            {#czmlBox[i][1].position.cartesian2 = [bb[i], ii[i]];#}
            dataSourceBox[i].process(czmlBox[i]);
            {#console.log(numm);#}
            {#console.log(k);#}
            {#console.log(kk);#}
        }
    }, 1000);
</script>
</body>
</html>